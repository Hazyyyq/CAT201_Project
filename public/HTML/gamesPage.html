<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaki Gamerz - Digital Store</title>
    <link rel="stylesheet" href="../CSS/gamesPage.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>

<nav>
    <div class="nav-content">
        <a href="/" class="logo">Kaki Gamerz</a>
        <div class="nav-links">
            <a href="/" style="color: #ccc; text-decoration: none; margin-right: 20px;">Home</a>
            <a href="cartPage.html" style="color: #0071e3; font-weight: bold;">
                Cart (<span id="cart-count">0</span>)
            </a>
        </div>
    </div>
</nav>

<header class="hero">
    <div class="hero-content">
        <span class="badge-hot">Top Seller</span>
        <h1>ELDEN RING: Shadow of the Erdtree</h1>
        <p>Dive into the expansion of the year. The Land of Shadow awaits.</p>
        <div class="hero-price">
            <span class="discount">-15%</span>
            <span class="price-old">RM 169.00</span>
            <span class="price-new">RM 143.65</span>
        </div>
        <button class="btn-hero" onclick="addToCartDirect('Elden Ring: Shadow of the Erdtree', 143.65, 'https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=2070')">
            Add to Cart
        </button>
    </div>
    <div class="hero-bg"></div>
</header>

<div class="container">
    <h2 class="section-title">Latest Games</h2>

    <div class="game-grid" id="game-grid-container">
        <p style="color:white">Loading games...</p>
    </div>

    <div class="pagination" id="pagination-controls">
    </div>
</div>

<script>
    // --- SETTINGS ---
    const itemsPerPage = 8;

    let allGames = [];
    let currentPage = 1;

    // 1. Fetch the JSON data
    fetch('/games.json')
        .then(response => response.json())
        .then(games => {
            allGames = games;
            displayList(allGames, document.getElementById('game-grid-container'), itemsPerPage, currentPage);
            setupPagination(allGames, document.getElementById('pagination-controls'), itemsPerPage);
        })
        .catch(err => console.error("Error loading games:", err));


    // 2. Display the Games for the specific Page
    function displayList(items, wrapper, rows_per_page, page) {
        wrapper.innerHTML = "";
        page--;

        let start = rows_per_page * page;
        let end = start + rows_per_page;
        let paginatedItems = items.slice(start, end);

        paginatedItems.forEach(game => {
            let badgeClass = 'discount-badge';
            if(game.badge === 'NEW') badgeClass += ' new';

            let oldPriceHTML = '';
            if(game.oldPrice) {
                oldPriceHTML = `<span class="price-old">RM ${game.oldPrice.toFixed(2)}</span>`;
            }

            const cardHTML = `
                <div class="game-card">
                    <div class="card-image">
                        <img src="${game.image}" alt="${game.name}">
                        <span class="${badgeClass}">${game.badge}</span>
                    </div>
                    <div class="card-info">
                        <h3 class="game-title">${game.name}</h3>
                        <div class="price-row">
                            ${oldPriceHTML}
                            <span class="price-new">RM ${game.price.toFixed(2)}</span>
                        </div>
                        <button class="btn-add" onclick="addToCartDirect('${game.name}', ${game.price}, '${game.image}')">
                            Add to Cart
                        </button>
                    </div>
                </div>
            `;
            wrapper.innerHTML += cardHTML;
        });
    }

    // 3. Create Page Buttons (1, 2, 3...)
    function setupPagination(items, wrapper, rows_per_page) {
        wrapper.innerHTML = "";
        let page_count = Math.ceil(items.length / rows_per_page);

        // Don't show buttons if only 1 page
        if(page_count < 2) return;

        for (let i = 1; i < page_count + 1; i++) {
            let btn = paginationButton(i, items);
            wrapper.appendChild(btn);
        }
    }

    function paginationButton(page, items) {
        let button = document.createElement('button');
        button.innerText = page;
        button.classList.add('page-btn');

        if (currentPage == page) button.classList.add('active');

        button.addEventListener('click', function () {
            currentPage = page;
            displayList(items, document.getElementById('game-grid-container'), itemsPerPage, currentPage);

            // Update Active Class
            let current_btn = document.querySelector('.page-btn.active');
            if(current_btn) current_btn.classList.remove('active');
            button.classList.add('active');

            // Optional: Scroll to top of grid
            document.querySelector('.container').scrollIntoView({behavior: 'smooth'});
        });

        return button;
    }

    // 4. Cart Logic
    function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem('kakiCart')) || [];
        document.getElementById('cart-count').innerText = cart.length;
    }
    updateCartCount();

    function addToCartDirect(name, price, imgUrl) {
        const newItem = {
            id: Date.now(),
            name: name,
            price: price,
            img: imgUrl,
            details: "Standard Edition",
            color: "N/A",
            size: "Standard"
        };
        let cart = JSON.parse(localStorage.getItem('kakiCart')) || [];
        cart.push(newItem);
        localStorage.setItem('kakiCart', JSON.stringify(cart));
        updateCartCount();
    }
</script>

</body>
</html>